# jdm 4/18/14
#
# index outside server as it applies to both server blocks
#
index index.php index.html index.htm;

server {
	listen  443;
	server_name tsx1.techsolx.com;
	ssl on;
	root /usr/share/nginx/www/tsx1.techsolx.com/public/;
# return 301 https://tsx1.techsolx.com$request_uri;
	ssl_certificate /etc/ssl/localcerts/tsx1.techsolx.com.crt;
	ssl_certificate_key /etc/ssl/private/tsx1.techsolx.com.key;
#
# redirect server error pages to the static page /50x.html
#
	error_page 404 /404.html;
	error_page 500 502 503 504 /50x.html;
	location = /50x.html {
		root /usr/share/nginx/www;
	}

#
# log files go here
#
	access_log /usr/share/nginx/www/tsx1.techsolx.com/log/access.log;
	error_log  /usr/share/nginx/www/tsx1.techsolx.com/log/error.log;
	rewrite_log on;

#
# don't allow access to .files
#
	location ~ /\. {
		deny all;
		access_log off;
		log_not_found off;
	}

#
# don't log access to favicon
#
	location = /favicon.ico {
		log_not_found off;
		access_log off;
	}

#
# what to do with robots
#
	location = /robots.txt {
		return 200 "User-agent: *\nDisallow: /";
		log_not_found off;
		access_log off;
	}

#
# what to do with php requests 
#
	location ~ \.php$ {
		try_files $uri =404;
		fastcgi_pass unix:/var/run/php5-fpm.sock;
		fastcgi_index index.php;
		fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
		include fastcgi_params;
	}

#
# go to phpmyadmin this way
#
	location /phpmyadmin {
		root /usr/share/;
		location ~ ^/phpmyadmin/(.+\.php)$ {
			try_files $uri $uri/ /index.php?q=$uri&$args;
			root /usr/share/;
			include /etc/nginx/fastcgi_params;
			fastcgi_pass unix:/var/run/php5-fpm.sock;
			fastcgi_param  HTTPS on;
			fastcgi_index index.php;
			fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;

		}
		location ~* ^/phpmyadmin/(.+\.(jpg|jpeg|gif|css|png|js|ico|html|xml|txt))$ {
			root /usr/share/;
		}
	}

	location /phpMyAdmin {
		rewrite ^/* /phpmyadmin last;
					}

#
#Go to squirrelmail this way
#
	location /squirrelmail {
	root /usr/share/;

		location ~ ^/squirrelmail/(.+\.php)$ {
		try_files $uri =404;
		root /usr/share/;
		include /etc/nginx/fastcgi_params;
		fastcgi_pass unix:/var/run/php5-fpm.sock;
		fastcgi_param  HTTPS on;
		fastcgi_index index.php;
		fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
		}
	}

	location ~* ^/squirrelmail/(.+\.(jpg|jpeg|gif|css|png|js|ico|html|xml|txt))$ {
	root /usr/share/;
	}

location /webmail {
rewrite ^/* /squirrelmail last;
}
}

